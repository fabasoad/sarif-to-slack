#!/usr/bin/env sh

version=$(jq -r '.version' package.json)
echo "/**" > src/metadata.ts
echo " * These values are used for the default footer in Slack message and in logging." >> src/metadata.ts
echo " *" >> src/metadata.ts
echo " * @privateRemarks" >> src/metadata.ts
echo " * This file is autogenerated by scripts/save-metadata.sh" >> src/metadata.ts
echo " * Do not edit it manually!" >> src/metadata.ts
echo " *" >> src/metadata.ts
echo " * @internal" >> src/metadata.ts
echo " */" >> src/metadata.ts
echo "export const LIB_VERSION = '${version}'" >> src/metadata.ts
echo "export const LIB_SHA = '$(git rev-parse HEAD)' // pragma: allowlist secret" >> src/metadata.ts
echo "export const LIB_BUILT_AT = '$(date +"%Y-%m-%dT%H:%M:%S%z")'" >> src/metadata.ts
